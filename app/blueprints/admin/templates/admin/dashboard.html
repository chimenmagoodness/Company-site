{% extends "base.html" %}

{% block head %}
    {% block title %}
        Admin Page
        
    {% endblock %}

    {% include "adminheader.html" %}
    {% include "sweetalerts.html" %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />

    <!-- Code highlighter -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

     <!-- SimpleMDE CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
    <!-- SimpleMDE JS -->
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>


{% endblock %}



{% block content %}

    <section class="partner pt-5" id="partner">
        <div class="container">
            <div class="partner_texts d-flex pb-3">
                <h3 class="partner__heading">Add New Company <span class="icon"><i class="bi bi-plus" data-bs-toggle="modal"
                            data-bs-target="#addCompanyModal"></i></span></h3>
                <a href="{{ url_for('partners.partners') }}" class="view_all">View All
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>

        <!-- Add New Partner Modal -->
        <div class="modal fade" id="addCompanyModal" tabindex="-1" aria-labelledby="addCompanyModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addCompanyModalLabel">Add New Company</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addPartnerForm" action="{{ url_for('partners.add_partner') }}" method="POST"
                            enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="newPartnerName" class="form-label">Partner Name</label>
                                <input type="text" class="form-control" id="newPartnerName" name="name" required>
                            </div>
                            <div class="mb-3">
                                <label for="newPartnerImage" class="form-label">Upload Image</label>
                                <input type="file" class="form-control" id="newPartnerImage" name="logo_image" accept="image/*"
                                    required>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Add Now</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        
        
        
        <!-- Display Partners -->
        <div class="partner__container">
            {% for partner in partners %}
            <div class="img__card">
                <!-- Update the image source to use 'partner.logo_image_id' directly -->
                <img src="{{ url_for('static', filename='uploads/' ~ partner.logo_image_id) }}" alt="{{ partner.name }}"
                    class="partner__img">
            
                <div class="edit_or_delete">
                    <span class="icon edit" data-bs-toggle="modal" data-bs-target="#editPartnerModal-{{ partner.partner_id }}">
                        <i class="bi bi-pen"></i>
                    </span>
                    <form id="deletePartnerForm-{{ partner.partner_id }}"
                        action="{{ url_for('partners.delete_partner', partner_id=partner.partner_id) }}" method="POST"
                        style="display:inline;">
                        <button type="button" class="icon delete" onclick="confirmPartnerDelete('{{ partner.partner_id }}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </form>
                </div>
            </div>
            <!-- Edit Partner Modal -->
            <div class="modal fade" id="editPartnerModal-{{ partner.partner_id }}" tabindex="-1"
                aria-labelledby="editPartnerModalLabel-{{ partner.partner_id }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editPartnerModalLabel-{{ partner.partner_id }}">Edit Company</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="editPartnerForm-{{ partner.partner_id }}"
                                action="{{ url_for('partners.edit_partner', partner_id=partner.partner_id) }}" method="POST"
                                enctype="multipart/form-data">

                                <div class="mb-3">
                                    <label for="editPartnerName-{{ partner.partner_id }}" class="form-label">Partner Name</label>
                                    <input type="text" class="form-control" id="editPartnerName-{{ partner.partner_id }}" name="name" value="{{ partner.name }}" required>
                                </div>

                                <div class="mb-3">
                                    <label for="editPartnerImage-{{ partner.partner_id }}" class="form-label">Upload Image</label>
                                    <input type="file" class="form-control" id="editPartnerImage-{{ partner.partner_id }}" name="logo_image" accept="image/*">
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

    </section>
    
    
    <!------------------------------------------------ Portfolio Section --------------------------------------->
    <section class="portfolio__section" id="portfolio">
    
        <div class="container">
    
            <div class="portfolio_texts d-flex pb-3">
                <h3 class="portfolio__heading text-dark">
                    Add New PortFolio
                    <span class="icon">
                        <i class="bi bi-plus" data-bs-toggle="modal" data-bs-target="#addPortfolioModal"></i>
                    </span>
                </h3>
                <a href="{{ url_for('portfolio.portfolios')}}" class="view_all">View All
                    <i class="bi bi-chevron-right" data-bs-toggle="modal" data-bs-target="#addCompanyModal"></i>
                </a>
            </div>
    
    
            <!-- Add New Portfolio Modal -->
            <div class="modal fade" id="addPortfolioModal" tabindex="-1" aria-labelledby="addPortfolioModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addPortfolioModalLabel">Add New Portfolio</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="{{ url_for('portfolio.add_portfolio') }}" method="POST" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="portfolioLocation" class="form-label">Location</label>
                                    <input type="text" class="form-control" id="portfolioLocation" name="location"
                                        placeholder="Enter location" required>
                                </div>
                                <div class="mb-3">
                                    <label for="portfolioType" class="form-label">Project Name</label>
                                    <input type="text" class="form-control" id="portfolioType" name="project_name"
                                        placeholder="Enter project name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="portfolioDescription" class="form-label">Description</label>
                                    <textarea class="form-control markdown-editor" id="portfolioDescription" name="description"
                                        placeholder="Enter project description" rows="3"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="portfolioImageInput" class="form-label">Upload Images</label>
                                    <input type="file" class="form-control" id="portfolioImageInput" name="image_ids[]"
                                        accept="image/*" multiple>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Save Portfolio</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
    
    
    
            <!-- Display Portfolio -->
            <div class="portfolio_card">
                <div class="portfolio__container">
                    {% for item in portfolio %}
                    <div class="portfolio">
                        <div class="img__div">
                            {% if item.media and item.media|length > 0 %}
                                <img src="{{ url_for('static', filename='uploads/' ~ item.media[0].filename) }}" alt="{{ item.project_name }}"
                                    class="project__img">
                            {% else %}
                                <img src="{{ url_for('static', filename='images/default-image.png') }}" alt="Default Image" class="project__img">
                            {% endif %}

                        </div>
                        <ul>
                            <li>
                                <p class="location">{{ item.location }}</p>
                            </li>
                        </ul>
                        <a class="project__type" href="{{ url_for('portfolio.portfolio_details', project_name=item.project_name) }}">
                            {{ item.project_name }}
                        </a>
                        
                        <div class="edit_or_delete">
                            <!-- Edit button -->
                            <span class="icon edit" data-bs-toggle="modal"
                                data-bs-target="#editPortfolioModal-{{ item.portfolio_id }}">
                                <i class="bi bi-pen"></i>
                            </span>
            
                            <!-- Delete button with SweetAlert confirmation -->
                            <form id="deletePortfolioForm-{{ item.portfolio_id }}"
                                action="{{ url_for('portfolio.delete_portfolio', portfolio_id=item.portfolio_id) }}" method="POST"
                                style="display:inline;">
                                <button type="button" class="icon delete"
                                    onclick="confirmDeletePortfolio('{{ item.portfolio_id }}')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
    
            {% if portfolio %}
                {% for item in portfolio %}
                    <!-- Edit Portfolio Modal -->
                    <div class="modal fade" id="editPortfolioModal-{{ item.portfolio_id }}" tabindex="-1"
                        aria-labelledby="editPortfolioModalLabel-{{ item.portfolio_id }}" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editPortfolioModalLabel-{{ item.portfolio_id }}">Edit Portfolio</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form action="{{ url_for('portfolio.edit_portfolio', portfolio_id=item.portfolio_id) }}" method="POST"
                                        enctype="multipart/form-data">
                                        <div class="mb-3">
                                            <label for="portfolioLocation" class="form-label">Location</label>
                                            <input type="text" class="form-control" id="portfolioLocation" name="location"
                                                value="{{ item.location }}" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="portfolioType" class="form-label">Project Name</label>
                                            <input type="text" class="form-control" id="portfolioType" name="project_name"
                                                value="{{ item.project_name }}" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="portfolioDescription" class="form-label">Description</label>
                                            <textarea class="form-control markdown-editor" id="editportfolioDescription" name="description" rows="4"
                                                required>{{ item.description }}</textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="portfolioImageInput" class="form-label">Upload New Images</label>
                                            <input type="file" class="form-control" id="portfolioImageInput" name="image_ids[]"
                                                accept="image/*" multiple>
                                        </div>
                                        <div class="mb-3">
                                            <label for="existingImages" class="form-label">Existing Images</label>
                                            <div id="existingImages">
                                                {% for media in item.media %}
                                                <div class="existing-image" data-media-id="{{ media.media_id }}">
                                                    <img src="{{ url_for('static', filename='uploads/' ~ media.filename) }}" alt="Existing Image"
                                                        class="img-thumbnail" style="max-width: 100px;">
                                                    <button type="button" class="btn btn-danger btn-sm"
                                                        onclick="confirmDeletePortfolioImage('{{ item.portfolio_id }}', '{{ media.media_id }}')">Delete</button>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-primary">Save Changes</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-center text-danger fs-5">No PortFolio available.</p>
        {% endif %}
    </section>
    
    
    <!------------------------------------------------ Change Video URL and Description Section --------------------------------------->

    <section class="video" id="videoSection">
        <div class="container">
            <h3 class="video__heading">
                {% if video %}
                Change Video URL and Description
                <span class="icon">
                    <i class="bi bi-pen fs-4" data-bs-toggle="modal" data-bs-target="#changeVideoUrlModal"></i>
                </span>
                {% else %}
                No video available. 
                <span class="icon">
                    <i class="bi bi-plus fs-3" data-bs-toggle="modal" data-bs-target="#changeVideoUrlModal"></i>
                </span>
                {% endif %}
            </h3>
        </div>
    
        {% if video %}
        <div class="video__category">
            <hr>
            <h1 class="category__heading">{{ video.title }}</h1>
            
            <div class="space">
                <iframe src="{{ video.url }}" frameborder="0" allowfullscreen></iframe>
            </div>

            <p class="category__subheading mb-1">{{ video.description }}</p>
            <hr>
        </div>
        {% endif %}
    
        <!-- Change/Add Video URL, Title, and Description Modal -->
        <div class="modal fade" id="changeVideoUrlModal" tabindex="-1" aria-labelledby="changeVideoUrlModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="changeVideoUrlModalLabel">
                            {{ "Change" if video else "Add" }} Video URL, Title, and Description
                        </h5>

                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="{{ url_for('videos.change_video_url', video_id=video.video_url_id if video else 0) }}" method="POST">
                            <div class="mb-3">
                                <label for="videoTitleInput" class="form-label">Title</label>
                                <input type="text" class="form-control" id="videoTitleInput" name="title"
                                    value="{{ video.title if video else '' }}" placeholder="Enter title" required>
                            </div>
                            <div class="mb-3">
                                <label for="videoUrlInput" class="form-label">Video URL</label>
                                <input type="url" class="form-control" id="videoUrlInput" name="video_url"
                                    value="{{ video.url if video else '' }}" placeholder="Enter video URL" required>
                            </div>
                            <div class="mb-3">
                                <label for="videoDescriptionInput" class="form-label markdown-editor">Description</label>
                                <textarea class="form-control testimnialcontent" id="videoDescriptionInput" name="video_description"
                                    placeholder="Enter description"
                                    required>{{ video.description if video else '' }}</textarea>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">
                                    {{ "Save changes" if video else "Add Video" }}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    
    
    
    <!------------------------------------------------ Case Studies Section --------------------------------------->
    <section class="case_stdies" id="caseStudies">
        <div class="container">
            <div class="case_texts d-flex pb-3">
                <h3 class="case__heading text-center">Add New Case Studies <span class="icon"><i class="bi bi-plus"
                            data-bs-toggle="modal" data-bs-target="#addCaseStudyModal"></i></span></h3>
                <a class="view_all" href="{{ url_for('casestudies.case_studies') }}">View All
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>
            <!-- <h3 class="case__heading text-center">Add New Case Studies <span class="icon"><i class="bi bi-plus" data-bs-toggle="modal" data-bs-target="#addCaseStudyModal"></i></span></h3> -->
    
            <!-- Add New Case Study Modal -->
            <div class="modal fade" id="addCaseStudyModal" tabindex="-1" aria-labelledby="addCaseStudyModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addCaseStudyModalLabel">Add New Case Study</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form method="POST" action="{{ url_for('casestudies.add_case_study') }}" id="addCaseStudyForm" enctype="multipart/form-data" onsubmit="tinymce.triggerSave();">
                                <div class="mb-3">
                                    <label for="projectName" class="form-label">Project Name</label>
                                    <input type="text" class="form-control" id="projectName" name="project_name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="description" class="form-label">Description</label>
                                    <!-- MDEditor textarea -->
                                    <textarea class="form-control markdown-editor" id="casedescription" name="casedescription" rows="3" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="images" class="form-label">Upload Images</label>
                                    <input type="file" class="form-control" id="images" name="images" multiple required>
                                </div>
                                <button type="submit" class="btn btn-primary">Add Case Study</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
    
    
    
            <!-- Display Case Studies -->
            {% for case_study in case_studies %}
            <div class="case__studies-section mb-5">
                <div class="other__categories-container">
                    <div class="categories__text">
                        <h2 class="project__heading">{{ case_study.project_name }}</h2>
                        <p class="project__descr text-dark">
                            <div class="container markdown-content">
                                {% if case_study.description | length > 500 %}
                                {{ case_study.description[:500] | markdown | safe }}
                                {% else %}
                                {{ case_study.description | markdown | safe }}
                                {% endif %}
                            </div>
                            
                            
                        </p>
                        <div class="button-container project-btn">
                            <a href="{{ url_for('casestudies.case_study_details', case_study_slug=case_study.project_name | slugify) }}"
                                class="connect__btn">Read More</a>
                            <span class="icon"><i class="bi bi-chevron-right"></i></span>
                        </div>
                        <div class="edit_or_delete mt-3">
                            <span class="icon edit" data-bs-toggle="modal"
                                data-bs-target="#editCaseStudyModal-{{ case_study.case_study_id }}">
                                <i class="bi bi-pen"></i>
                            </span>
                            <form action="{{ url_for('casestudies.delete_case_study', case_study_id=case_study.case_study_id) }}"
                                method="POST" id="deleteCaseForm-{{ case_study.case_study_id }}" style="display:inline;">
                                <button type="button" class="btn btn-link delete"
                                    onclick="confirmDeleteCaseStudy({{ case_study.case_study_id }})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    <div class="categories__images mt-4">
                        {% if case_study.images | length > 0 %}
                        <a href="#" class="text-none case_img_container" data-toggle="modal modal-lg" data-target="#myModal">
                            <img src="{{ url_for('static', filename='uploads/' ~ case_study.images[0].image_path) }}" alt=""
                                class="img-fluid me-2">
                        </a>
                        {% endif %}
                    </div>
                </div>
                <hr>
            </div>
            {% endfor %}

    
            <!-- {% for case_study in case_studies %} -->
            <!-- Edit Case Study Modal -->
            <div class="modal fade" id="editCaseStudyModal-{{ case_study.case_study_id }}" tabindex="-1"
                aria-labelledby="editCaseStudyModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editCaseStudyModalLabel">Edit Case Study</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form class="edit-case-study-form"
                                action="{{ url_for('casestudies.edit_case_study', case_study_id=case_study.case_study_id) }}"
                                method="POST" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="editCaseStudyTitle" class="form-label">Case Study Title</label>
                                    <input type="text" class="form-control" id="editCaseStudyTitle" name="project_name"
                                        value="{{ case_study.project_name }}" placeholder="Enter title" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editCaseStudyDescription-{{ case_study.case_study_id }}"
                                        class="form-label">Description</label>
                                    <textarea class="form-control markdown-editor"
                                        id="editCaseStudyDescription" name="description"
                                        rows="6" placeholder="Enter description"
                                        required>{{ case_study.description }}
                                    </textarea>
                                    
                                </div>
                                <div class="mb-3">
                                    <label for="editCaseStudyImageInput" class="form-label">Upload Images</label>
                                    <input type="file" class="form-control" id="editCaseStudyImageInput" name="images"
                                        accept="image/*" multiple>
                                </div>
                                <!-- Existing Images Section -->
                                <div class="mb-3">
                                    <label class="form-label">Existing Images</label>
                                    <div class="existing-images">
                                        {% for image in case_study.images %}
                                        <div class="image-container" data-image-path="{{ image.image_path }}">
                                            <img src="{{ url_for('static', filename='uploads/' + image.image_path) }}"
                                                alt="Image" class="img-thumbnail" style="max-width: 150px;">
                                            <!-- Form for Deleting Image -->
    
                                            <button type="button" class="btn btn-danger btn-sm ms-2"
                                                onclick="confirmDeleteCaseImage({{ case_study.case_study_id }}, '{{ image.image_path }}')">
                                                Delete
                                            </button>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Update Case Study</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- {% endfor %} -->
    
    
            <!-- View Image Modal -->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title" id="myModalLabel">View Image</h4>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Modal content goes here -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
    
    
    
            <!-- Confirmation Dialog for Deleting Image -->
            <div class="modal fade" id="confirmDeleteCaseImageDialog" tabindex="-1"
                aria-labelledby="confirmDeleteCaseImageDialogLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="confirmDeleteCaseImageDialogLabel">Confirm Deletion</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to delete this image?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <!-- <button type="button" class="btn btn-primary" id="confirmDeleteCaseImageButton">Delete</button> -->
                        </div>
                    </div>
                </div>
            </div>
    
    
        </div>
    </section>
    
    
    <!------------------------------------------------ Blog Section --------------------------------------->
    <section class="blog__section" id="blog">
    
        <div class="container">
            <!-- <h3 class="blog__heading">Add New blog <span class="icon"><i class="bi bi-plus" data-bs-toggle="modal" data-bs-target="#addBlogModal"></i></span></h3> -->
            <div class="blog_texts d-flex p-3">
                <h3 class="blog__heading">Add New blog <span class="icon"><i class="bi bi-plus" data-bs-toggle="modal"
                            data-bs-target="#addBlogModal"></i></span></h3>
                <a href="{{ url_for('blogs.blogs') }}" class="view_all">View All
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>
    
            <!-- Add Modal -->
            <div class="modal fade" id="addBlogModal" tabindex="-1" aria-labelledby="addBlogModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addBlogModalLabel">Add New Blog</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Your Form Here -->
                            <form id="addBlogForm" enctype="multipart/form-data" method="POST" action="{{ url_for('blogs.add_blog')}}">
                                <!-- Image Preview (optional, will be updated with JS) -->
                                <div id="imagePreview" class="mb-3" style="display: none;">
                                    <img id="selectedImage" src="#" alt="Selected Image" class="img-fluid">
                                </div>                                
                                <div class="mb-3">
                                    <label for="blogTitle" class="form-label">Blog Title</label>
                                    <input type="text" class="form-control" id="blogTitle" name="title"
                                        placeholder="Enter blog title">
                                </div>
                                <div class="mb-3">
                                    <label for="blogContent" class="form-label">Blog Content</label>
                                    <textarea class="form-control markdown-editor" id="blogContent" name="content" rows="5"></textarea>
                                </div>

                                <!-- Image Picker -->
                                <div class="mb-3">
                                    <label for="imageInput" class="form-label">Upload Images</label>
                                    <input type="file" class="form-control" id="imageInput" name="images[]" accept="image/*" multiple>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" form="addBlogForm" class="btn btn-primary">Save Blog</button>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="section__container">
                <div class="blog__container">
                    {% for blog in blogs %}
                    <div class="blog__card">
                        <img src="{{ url_for('static', filename='uploads/' ~ blog.first_image_path) if blog.first_image_path else 'static/images/default-image.jpg' }}"
                            alt="{{ blog.title }}">
                        <div class="text-box">
                            <a class="blog_title" href="{{ url_for('blogs.blog_details', blog_id=blog.blog_id) }}">
                                {% if blog.title|length > 200 %}
                                {{ blog.title[:200] }}
                                {% else %}
                                {{ blog.title }}
                                {% endif %}
                            </a>
                            <div class="edit_or_delete">
                                <!-- <span class="icon edit" data-blog-id="{{ blog.blog_id }}" data-bs-toggle="modal"
                                        data-bs-target="#editBlogModal" onclick="openEditBlogModal({{ blog.blog_id }})">
                                        <i class="bi bi-pen"></i>
                                    </span> -->
                                <span class="icon edit" data-bs-toggle="modal"
                                    data-bs-target="#editBlogModal-{{ blog.blog_id }}">
                                    <i class="bi bi-pen"></i>
                                </span>
                                <form method="POST" id="deleteBlogForm-{{ blog.blog_id }}"
                                    action="{{ url_for('blogs.delete_blog', blog_id=blog.blog_id) }}" style="display:inline;">
                                    <button type="button" class="icon delete" onclick="confirmDeleteBlog('{{ blog.blog_id }}')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
    
                </div>
    
                <div class="blog__blank">
                    <h3>Our Recommended Blog</h3>
                    <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit.
                        Corrupti quam harum, veritatis perspiciatis iste ducimus tenetur ex error possimus recusandae
                        molestiae itaque
                        accusamus quae reiciendis cupiditate.
                        Beatae dolorem quia quaerat.
                    </p>
                    <div class="edit_or_delete">
                        <span class="icon edit"><i class="bi bi-pen"></i></span>
    
                        <span class="icon delete"><i class="bi bi-trash"></i></span>
                    </div>
                </div>
    
    
    
                <!-- Edit Blog Modal -->
                {% for blog in blogs %}
                <div class="modal fade" id="editBlogModal-{{ blog.blog_id }}" tabindex="-1"
                    aria-labelledby="editBlogModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editBlogModalLabel">Edit Blog</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editBlogForm-{{ blog.blog_id }}" method="POST"
                                    action="{{ url_for('blogs.edit_blog', blog_id=blog.blog_id) }}" enctype="multipart/form-data">
                                    <input type="hidden" name="blog_id" value="{{ blog.blog_id }}">
    
                                    <div class="mb-3">
                                        <label for="editBlogTitle-{{ blog.blog_id }}" class="form-label">Title</label>
                                        <input type="text" class="form-control" id="editBlogTitle-{{ blog.blog_id }}"
                                            name="title" value="{{ blog.title }}" required>
                                    </div>
    
                                    <div class="mb-3">
                                        <label for="editBlogContent-{{ blog.blog_id }}" class="form-label markdown-editor">Content</label>
                                        <textarea class="form-control markdown-editor" id="editBlogContent" name="content"
                                            rows="10">{{ blog.content }}</textarea>
                                    </div>
    
                                    <div class="mb-3">
                                        <label class="form-label">Current Images</label>
                                        <div id="editBlogImages-{{ blog.blog_id }}" class="edit__blog-existing-images">
                                            {% for image in blog.images %}
                                            <div class="image-container" data-image-id="{{ image.blog_media_id }}">
                                                <img src="{{ url_for('static', filename='uploads/' ~ image.filename) }}"
                                                    alt="Blog Image" class="img-thumbnail" style="max-width: 150px; max-height: 100px;">
                                                <button type="button" class="btn btn-danger btn-sm ms-2 img_del_btn"
                                                    onclick="deleteEditBlogImage({{ image.blog_media_id }}, '{{ image.filename }}')">Delete</button>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
    
                                    <div class="mb-3">
                                        <label for="newBlogImages-{{ blog.blog_id }}" class="form-label">Add New
                                            Images</label>
                                        <input type="file" class="form-control" id="newBlogImages-{{ blog.blog_id }}"
                                            name="images[]" accept="image/*" multiple>
                                    </div>
    
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
    
            </div>
    
        </div>
    
    </section>
    
    
    
    <!------------------------------------------------ Testimonial Section --------------------------------------->
    <section class="testimonials" id="testimonials">
    
        <div class="container">
            <div class="testimonial_texts d-flex p-3">
                <h3 class="testimonial__heading">Add New Testimonial <span class="icon"><i class="bi bi-plus"
                            data-bs-toggle="modal" data-bs-target="#addTestimonialModal"></i></span></h3>
                <!-- <a class="view_all">View All
                        <i class="bi bi-chevron-right" data-bs-toggle="modal" data-bs-target="#addCompanyModal"></i>
                    </a> -->
                <a class="view_all" href="{{ url_for('testimonials.testimonials') }}">View All
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>
    
    
            <!-- Add New Testimonial Modal -->
            <div class="modal fade" id="addTestimonialModal" tabindex="-1" aria-labelledby="addTestimonialModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addTestimonialModalLabel">Add New Testimonial</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Testimonial Form -->
                            <form action="{{ url_for('testimonials.add_testimonial') }}" method="POST" enctype="multipart/form-data">
    
                                
                                <!-- Testifier Name -->
                                <div class="mb-3">
                                    <label for="testifierName" class="form-label">Name</label>
                                    <input type="text" class="form-control testimonial-input" id="testifierName" name="testifierName"
                                        placeholder="Enter name" required>
                                </div>
    
                                <!-- Testifier Title -->
                                <div class="mb-3">
                                    <label for="testifierTitle" class="form-label">Title</label>
                                    <input type="text" class="form-control" id="testifierTitle" name="testifierTitle"
                                        placeholder="Enter title (e.g., architect)" required>
                                </div>
    
                                <!-- Testimonial Text -->
                                <div class="mb-3">
                                    <label for="testimonialText" class="form-label">Testimonial Text</label>
                                    <textarea type="text" class="form-control testimnialcontent" id="testimonialText" name="testimonialText" row="6"
                                        placeholder="Enter testimony" required rows="6"></textarea>
                                </div>

                                <!-- Image Preview -->
                                <div id="imagePreview" class="mb-3" style="display: none;">
                                    <img id="editSelectedImage" src="#" alt="Selected Image" class="img-fluid">
                                </div>
                                
                                <!-- Image Picker -->
                                <div class="mb-3">
                                    <label for="imageInput" class="form-label">Upload Image (only 1 image allowed)</label>
                                    <input type="file" class="form-control" id="editImageInput" name="image" accept="image/*"
                                        onchange="previewImage(event)" required>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary" id="submitTestimonial" onclick="disableSubmitButton()">Save
                                        Testimonial</button>
                                </div>

                            </form>
                        </div>
                    </div>
                </div>
            </div>
    
            {% for testimonial in testimonials %}
            <!-- Display Testimonials -->
            <div class="testimonial__grid">
                <div class="testimonialBox">
                    <img src="{{ url_for('static', filename='images/quotes.PNG') }}" alt="" class="quote">
                    <div class="content">
                        <p>{{ testimonial.content }}</p>
                        <div class="details">
                            <div class="imgBx">
                                <!-- Load the image from the database or a default image if not available -->
                                {% if testimonial.image_id %}
                                <img src="{{ url_for('static', filename='uploads/' + testimonial.image.filename) }}"
                                    alt="{{ testimonial.name }}">
                                {% else %}
                                <img src="{{ url_for('static', filename='images/default-image.jpg') }}"
                                    alt="Astructs Default Image">
                                {% endif %}
    
                            </div>
                            <h3 class="name">{{ testimonial.name }}<br><span class="title">{{ testimonial.title }}</span>
                            </h3>
                        </div>
                    </div>
                    <div class="edit_or_delete">
                        <!-- Edit button (triggers modal) -->
                        <!-- Trigger Edit Testimonial Modal -->
    
                        <span class="icon edit">
                            <a href="/edit-testimonial/{{ testimonial.testimonial_id }}" data-bs-toggle="modal"
                                data-bs-target="#editTestimonialModal"><i class="bi bi-pen text-light"></i></a>
                        </span>
    
                        <form method="POST"
                            action="{{ url_for('testimonials.delete_testimonial', testimonial_id=testimonial.testimonial_id) }}"
                            style="display:inline;">
                            <button type="button" class="icon delete"
                                onclick="confirmDeleteTestimonial(this.form, '{{ testimonial.testimonial_id }}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
    
                    </div>
                </div>
    
            </div>
            {% endfor %}
    
            {% for testimonial in testimonials %}
            <!-- Edit Testimonial Modal -->
            <div class="modal fade" id="editTestimonialModal" tabindex="-1" aria-labelledby="editTestimonialModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editTestimonialModalLabel">Edit Testimonial</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="editTestimonialForm" enctype="multipart/form-data" action="{{ url_for('testimonials.update_testimonial', testimonial_id=testimonial.testimonial_id) }}"
                                method="post">
                                <input type="hidden" id="editTestimonialId" name="testimonial_id"
                                    value="{{ testimonial.testimonial_id }}">
                                <div class="form-group">
                                    <label for="editTestifierName">Name</label>
                                    <input type="text" class="form-control" id="editTestifierName" name="name"
                                        value="{{ testimonial.name }}">
                                </div>
                                <div class="form-group">
                                    <label for="editTestifierTitle">Title</label>
                                    <input type="text" class="form-control" id="editTestifierTitle" name="title"
                                        value="{{ testimonial.title }}">
                                </div>
                                <label for="editTestimonialText">Content</label>
                                <textarea class="form-control testimnialcontent" id="editTestimonialText" rows="6"
                                    name="content">{{ testimonial.content }}</textarea>
                                <div class="form-group d-block p-3">
                                    <label for="editSelectedImage">Current Image</label>
                                    <div class="img-container d-flex pt-3">
                                        {% if testimonial.image and testimonial.image.filename %}
                                        <img src="{{ url_for('static', filename='uploads/' + testimonial.image.filename) }}" class="rounded"
                                            id="editSelectedImage" alt="Testimonial Image" style="height: 150px; width: 150px;">
                                        {% else %}
                                        <p>You have no current image</p>
                                        {% endif %}
                                    </div>
    
                                </div>
                                <div class="form-group">
                                    <label for="editImageInput">Update Image</label>
                                    <input type="file" class="form-control" id="editImageInput" name="image">
                                </div>
                                <div id="editImagePreview">
    
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Close</button>
                                        <button type="submit" class="btn btn-primary">Save changes</button>
                                    </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
    
    
        </div>
    </section>
    
    
    
    <section class="manageusers" id="users">
    
        <div class="container mt-5">
            <h1>Manage Users</h1>
            <table class="table table-striped mt-4">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Admin</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ 'Yes' if user.is_admin else 'No' }}</td>
                        <td>
                            {% if user.is_admin %}
                            <button class="btn btn-warning btn-sm"
                                onclick="confirmRemoveAdmin('{{ url_for('admin.remove_admin', user_id=user.id) }}')">
                                Remove Admin
                            </button>

                            {% else %}
                            <button class="btn btn-primary btn-sm" onclick="confirmMakeAdmin('{{ url_for('admin.make_admin', user_id=user.id) }}')">
                                Make Admin
                            </button>
                            {% endif %}
                            <button class="btn btn-danger btn-sm"
                                onclick="confirmDeleteUser('{{ url_for('admin.delete_user', user_id=user.id) }}')">
                                Delete User
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>

    
{% endblock %}

{% block scripts %}


    <script integrity="sha384-MrcW6ZMFYlXZ
                        *zcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <!-- SWIPER JS CODE -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    
    <!-- BOOTSTRAP CDN LINK -->
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    
    <script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script>
    
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.6/dist/umd/popper.min.js"></script>
    
    <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>

    <script>
        document.querySelectorAll('.markdown-content a').forEach(function (anchor) {
            anchor.setAttribute('target', '_blank');
        });

    </script>
{% endblock %}