{% extends "base.html" %}

{% block head %}
    {% block title %}
        Admin Page
        
    {% endblock %}
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}



{% block content %}
    {% include "adminheader.html" %}
    {% include "sweetalerts.html" %}
    <section class="partner pt-5" id="partner">
        <div class="container">
            <div class="partner_texts d-flex pb-3">
                <h3 class="partner__heading">Add New Company <span class="icon"><i class="bi bi-plus" data-bs-toggle="modal"
                            data-bs-target="#addCompanyModal"></i></span></h3>
                <a href="{{ url_for('partners.partners') }}" class="view_all">View All
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>

            <!-- Add New Partner Modal -->
            <div class="modal fade" id="addCompanyModal" tabindex="-1" aria-labelledby="addCompanyModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addCompanyModalLabel">Add New Company</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="addPartnerForm" action="{{ url_for('partners.add_partner') }}" method="POST"
                                enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="newPartnerName" class="form-label">Partner Name</label>
                                    <input type="text" class="form-control" id="newPartnerName" name="name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="newPartnerImage" class="form-label">Upload Image</label>
                                    <input type="file" class="form-control" id="newPartnerImage" name="logo_image" accept="image/*"
                                        required>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Add Now</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        
        
        
        
            <!-- Display Partners -->
            <div class="row">
                <div class="partner__container">
                    {% for partner in partners[:4] %}
                    <div class="img__card">
                        <!-- Update the image source to use 'partner.logo_image_id' directly -->
                        <img src="{{ url_for('static', filename='uploads/' ~ partner.logo_image_id) }}" alt="{{ partner.name }}"
                            class="partner__img">
                
                        <div class="edit_or_delete">
                            <span class="icon edit" data-bs-toggle="modal" data-bs-target="#editPartnerModal-{{ partner.partner_id }}">
                                <i class="bi bi-pen"></i>
                            </span>
                            <form id="deletePartnerForm-{{ partner.partner_id }}"
                                action="{{ url_for('partners.delete_partner', partner_id=partner.partner_id) }}" method="POST"
                                style="display:inline;">
                                <button type="button" class="icon delete" onclick="confirmPartnerDelete('{{ partner.partner_id }}')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    <!-- Edit Partner Modal -->
                    <div class="modal fade" id="editPartnerModal-{{ partner.partner_id }}" tabindex="-1"
                        aria-labelledby="editPartnerModalLabel-{{ partner.partner_id }}" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editPartnerModalLabel-{{ partner.partner_id }}">Edit Company</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="editPartnerForm-{{ partner.partner_id }}"
                                        action="{{ url_for('partners.edit_partner', partner_id=partner.partner_id) }}" method="POST"
                                        enctype="multipart/form-data">
                
                                        <div class="mb-3">
                                            <label for="editPartnerName-{{ partner.partner_id }}" class="form-label">Partner
                                                Name</label>
                                            <input type="text" class="form-control" id="editPartnerName-{{ partner.partner_id }}"
                                                name="name" value="{{ partner.name }}" required>
                                        </div>
                
                                        <div class="mb-3">
                                            <label for="editPartnerImage-{{ partner.partner_id }}" class="form-label">Upload
                                                Image</label>
                                            <input type="file" class="form-control" id="editPartnerImage-{{ partner.partner_id }}"
                                                name="logo_image" accept="image/*">
                                        </div>
                
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-primary">Save Changes</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
        </div>

    </section>
    
    
    <!------------------------------------------------ Portfolio Section --------------------------------------->
    <section class="portfolio__section" id="portfolio">
    
        <div class="container">
    
            <div class="portfolio_texts d-flex pb-3">
                <h3 class="portfolio__heading text-dark">
                    Add New PortFolio
                    <span class="icon">
                        <i class="bi bi-plus" data-bs-toggle="modal" data-bs-target="#addPortfolioModal"></i>
                    </span>
                </h3>
                <a href="{{ url_for('portfolio.portfolios')}}" class="view_all">View All
                    <i class="bi bi-chevron-right" data-bs-toggle="modal" data-bs-target="#addCompanyModal"></i>
                </a>
            </div>
    
    
            <!-- Add New Portfolio Modal -->
            <div class="modal fade" id="addPortfolioModal" tabindex="-1" aria-labelledby="addPortfolioModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addPortfolioModalLabel">Add New Portfolio</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="{{ url_for('portfolio.add_portfolio') }}" method="POST" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="portfolioLocation" class="form-label">Location</label>
                                    <input type="text" class="form-control" id="portfolioLocation" name="location"
                                        placeholder="Enter location" required>
                                </div>
                                <div class="mb-3">
                                    <label for="portfolioType" class="form-label">Project Name</label>
                                    <input type="text" class="form-control" id="portfolioType" name="project_name"
                                        placeholder="Enter project name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="portfolioDescription" class="form-label">Description</label>
                                    <textarea class="form-control markdown-editor" id="portfolioDescription" name="description"
                                        placeholder="Enter project description" rows="3"></textarea>
                                    <a href="https://froala.com/blog/editor/10-quick-tips-about-a-great-markdown-editor/" target="_blank" class="text-decoration-none">Click here to learn how to use this form</a>
                                </div>
                                <div class="mb-3">
                                    <label for="portfolioImageInput" class="form-label">Upload Images</label>
                                    <input type="file" class="form-control" id="portfolioImageInput" name="image_ids[]"
                                        accept="image/*" multiple>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Save Portfolio</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
    
    
    
            <!-- Display Portfolio -->
            <div class="portfolio_card">
                <div class="portfolio__container">
                    {% for item in portfolio[:3] %}
                    <div class="portfolio">
                        <div class="img__div">
                            {% if item.media and item.media|length > 0 %}
                                <img src="{{ url_for('static', filename='uploads/' ~ item.media[0].filename) }}" alt="{{ item.project_name }}"
                                    class="project__img">
                            {% else %}
                                <img src="{{ url_for('static', filename='images/default-image.png') }}" alt="Default Image" class="project__img">
                            {% endif %}

                        </div>
                        <ul>
                            <li>
                                <p class="location">{{ item.location }}</p>
                            </li>
                        </ul>
                        <a class="project__type" href="{{ url_for('portfolio.portfolio_details', project_name=item.project_name) }}">
                            {{ item.project_name }}
                        </a>
                        
                        <div class="edit_or_delete">
                            <!-- Edit button -->
                            <span class="icon edit" data-bs-toggle="modal"
                                data-bs-target="#editPortfolioModal-{{ item.portfolio_id }}">
                                <i class="bi bi-pen"></i>
                            </span>
            
                            <!-- Delete button with SweetAlert confirmation -->
                            <form id="deletePortfolioForm-{{ item.portfolio_id }}"
                                action="{{ url_for('portfolio.delete_portfolio', portfolio_id=item.portfolio_id) }}" method="POST"
                                style="display:inline;">
                                <button type="button" class="icon delete"
                                    onclick="confirmDeletePortfolio('{{ item.portfolio_id }}')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
    
            {% if portfolio %}
                {% for item in portfolio %}
                    <!-- Edit Portfolio Modal -->
                    <div class="modal fade" id="editPortfolioModal-{{ item.portfolio_id }}" tabindex="-1"
                        aria-labelledby="editPortfolioModalLabel-{{ item.portfolio_id }}" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editPortfolioModalLabel-{{ item.portfolio_id }}">Edit Portfolio</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form action="{{ url_for('portfolio.edit_portfolio', portfolio_id=item.portfolio_id) }}" method="POST"
                                        enctype="multipart/form-data">
                                        <div class="mb-3">
                                            <label for="portfolioLocation" class="form-label">Location</label>
                                            <input type="text" class="form-control" id="portfolioLocation" name="location"
                                                value="{{ item.location }}" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="portfolioType" class="form-label">Project Name</label>
                                            <input type="text" class="form-control" id="portfolioType" name="project_name"
                                                value="{{ item.project_name }}" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="portfolioDescription" class="form-label">Description</label>
                                            <textarea class="form-control markdown-editor" id="editportfolioDescription" name="description" rows="4"
                                                required>{{ item.description }}</textarea>
                                            <a href="https://froala.com/blog/editor/10-quick-tips-about-a-great-markdown-editor/" target="_blank"
                                                class="text-decoration-none">Click here to learn how to use this form</a>

                                        </div>
                                        <div class="mb-3">
                                            <label for="portfolioImageInput" class="form-label">Upload New Images</label>
                                            <input type="file" class="form-control" id="portfolioImageInput" name="image_ids[]"
                                                accept="image/*" multiple>
                                        </div>
                                        <div class="mb-3">
                                            <label for="existingImages" class="form-label">Existing Images</label>
                                            <div id="existingImages">
                                                {% for media in item.media %}
                                                <div class="existing-image" data-media-id="{{ media.media_id }}">
                                                    <img src="{{ url_for('static', filename='uploads/' ~ media.filename) }}" alt="Existing Image"
                                                        class="img-thumbnail" style="max-width: 100px;">
                                                    <button type="button" class="btn btn-danger btn-sm"
                                                        onclick="confirmDeletePortfolioImage('{{ item.portfolio_id }}', '{{ media.media_id }}')">Delete</button>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-primary">Save Changes</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-center text-danger fs-5">No PortFolio available.</p>
        {% endif %}
    </section>
    
    
    <!------------------------------------------------ Change Video URL and Description Section --------------------------------------->

    <section class="video" id="videoSection">
        <div class="container">
            <h3 class="video__heading">
                {% if video %}
                Change Video URL and Description
                <span class="icon">
                    <i class="bi bi-pen fs-4" data-bs-toggle="modal" data-bs-target="#changeVideoUrlModal"></i>
                </span>
                {% else %}
                No video available. 
                <span class="icon">
                    <i class="bi bi-plus fs-3" data-bs-toggle="modal" data-bs-target="#changeVideoUrlModal"></i>
                </span>
                {% endif %}
            </h3>
        </div>
    
        {% if video %}
        <div class="video__category">
            <hr>
            <h1 class="category__heading">{{ video.title }}</h1>
            
            <div class="space">
                <iframe src="{{ video.url }}" frameborder="0" allowfullscreen></iframe>
            </div>

            <p class="category__subheading mb-1">{{ video.description }}</p>
            <hr>
        </div>
        {% endif %}
    
        <!-- Change/Add Video URL, Title, and Description Modal -->
        <div class="modal fade" id="changeVideoUrlModal" tabindex="-1" aria-labelledby="changeVideoUrlModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="changeVideoUrlModalLabel">
                            {{ "Change" if video else "Add" }} Video URL, Title, and Description
                        </h5>

                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="{{ url_for('videos.change_video_url', video_id=video.video_url_id if video else 0) }}" method="POST">
                            <div class="mb-3">
                                <label for="videoTitleInput" class="form-label">Title</label>
                                <input type="text" class="form-control" id="videoTitleInput" name="title"
                                    value="{{ video.title if video else '' }}" placeholder="Enter title" required>
                            </div>
                            <div class="mb-3">
                                <label for="videoUrlInput" class="form-label">Video URL</label>
                                <input type="url" class="form-control" id="videoUrlInput" name="video_url"
                                    value="{{ video.url if video else '' }}" placeholder="Enter video URL" required>
                            </div>
                            <div class="mb-3">
                                <label for="videoDescriptionInput" class="form-label markdown-editor">Description</label>
                                <textarea class="form-control testimnialcontent" id="videoDescriptionInput" name="video_description"
                                    placeholder="Enter description"
                                    required>{{ video.description if video else '' }}</textarea>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">
                                    {{ "Save changes" if video else "Add Video" }}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    
    
    
    <!------------------------------------------------ Case Studies Section --------------------------------------->
    <section class="case_stdies" id="caseStudies">
        <div class="container">
            <div class="case_texts d-flex pb-3">
                <h3 class="case__heading text-center">Add New Case Studies <span class="icon"><i class="bi bi-plus"
                            data-bs-toggle="modal" data-bs-target="#addCaseStudyModal"></i></span></h3>
                <a class="view_all" href="{{ url_for('casestudies.case_studies') }}">View All
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>
            <!-- <h3 class="case__heading text-center">Add New Case Studies <span class="icon"><i class="bi bi-plus" data-bs-toggle="modal" data-bs-target="#addCaseStudyModal"></i></span></h3> -->
    
            <!-- Add New Case Study Modal -->
            <div class="modal fade" id="addCaseStudyModal" tabindex="-1" aria-labelledby="addCaseStudyModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addCaseStudyModalLabel">Add New Case Study</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form method="POST" action="{{ url_for('casestudies.add_case_study') }}" id="addCaseStudyForm" enctype="multipart/form-data" onsubmit="tinymce.triggerSave();">
                                <div class="mb-3">
                                    <label for="projectName" class="form-label">Project Name</label>
                                    <input type="text" class="form-control" id="projectName" name="project_name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="description" class="form-label">Description</label>
                                    <!-- MDEditor textarea -->
                                    <textarea class="form-control markdown-editor" id="casedescription" name="casedescription" rows="3" required></textarea>
                                    <a href="https://froala.com/blog/editor/10-quick-tips-about-a-great-markdown-editor/" target="_blank"
                                        class="text-decoration-none">Click here to learn how to use this form</a>

                                </div>
                                <div class="mb-3">
                                    <label for="images" class="form-label">Upload Images</label>
                                    <input type="file" class="form-control" id="images" name="images" multiple required>
                                </div>
                                <button type="submit" class="btn btn-primary">Add Case Study</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
    
    
    
            <!-- Display Case Studies -->
            {% for case_study in case_studies[:3] %}
            <div class="case__studies-section mb-5">
                <div class="other__categories-container">
                    <div class="categories__text">
                        <h2 class="project__heading">{{ case_study.project_name }}</h2>
                        <p class="project__descr text-dark">
                            <div class="container markdown-content">
                                {% if case_study.description | length > 500 %}
                                {{ case_study.description[:500] | markdown | safe }}
                                {% else %}
                                {{ case_study.description | markdown | safe }}
                                {% endif %}
                            </div>
                            
                            
                        </p>
                        <div class="button-container project-btn">
                            <a href="{{ url_for('casestudies.case_study_details', case_study_slug=case_study.project_name | slugify) }}"
                                class="connect__btn">Read More</a>
                            <span class="icon"><i class="bi bi-chevron-right"></i></span>
                        </div>
                        <div class="edit_or_delete mt-3">
                            <span class="icon edit" data-bs-toggle="modal"
                                data-bs-target="#editCaseStudyModal-{{ case_study.case_study_id }}">
                                <i class="bi bi-pen"></i>
                            </span>
                            <form action="{{ url_for('casestudies.delete_case_study', case_study_id=case_study.case_study_id) }}"
                                method="POST" id="deleteCaseForm-{{ case_study.case_study_id }}" style="display:inline;">
                                <button type="button" class="btn btn-link delete"
                                    onclick="confirmDeleteCaseStudy({{ case_study.case_study_id }})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    <div class="categories__images mt-4">
                        {% if case_study.images | length > 0 %}
                        <a href="#" class="text-none case_img_container" data-toggle="modal modal-lg" data-target="#myModal">
                            <img src="{{ url_for('static', filename='uploads/' ~ case_study.images[0].image_path) }}" alt=""
                                class="img-fluid me-2">
                        </a>
                        {% endif %}
                    </div>
                </div>
                <hr>
            </div>
            {% endfor %}

    
            <!-- {% for case_study in case_studies %} -->
            <!-- Edit Case Study Modal -->
            <div class="modal fade" id="editCaseStudyModal-{{ case_study.case_study_id }}" tabindex="-1"
                aria-labelledby="editCaseStudyModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editCaseStudyModalLabel">Edit Case Study</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form class="edit-case-study-form"
                                action="{{ url_for('casestudies.edit_case_study', case_study_id=case_study.case_study_id) }}"
                                method="POST" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="editCaseStudyTitle" class="form-label">Case Study Title</label>
                                    <input type="text" class="form-control" id="editCaseStudyTitle" name="project_name"
                                        value="{{ case_study.project_name }}" placeholder="Enter title" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editCaseStudyDescription-{{ case_study.case_study_id }}"
                                        class="form-label">Description</label>
                                    <textarea class="form-control markdown-editor"
                                        id="editCaseStudyDescription" name="description"
                                        rows="6" placeholder="Enter description"
                                        required>{{ case_study.description }}
                                    </textarea>
                                    <a href="https://froala.com/blog/editor/10-quick-tips-about-a-great-markdown-editor/" target="_blank"
                                        class="text-decoration-none">Click here to learn how to use this form</a>

                                    
                                </div>
                                <div class="mb-3">
                                    <label for="editCaseStudyImageInput" class="form-label">Upload Images</label>
                                    <input type="file" class="form-control" id="editCaseStudyImageInput" name="images"
                                        accept="image/*" multiple>
                                </div>
                                <!-- Existing Images Section -->
                                <div class="mb-3">
                                    <label class="form-label">Existing Images</label>
                                    <div class="existing-images">
                                        {% for image in case_study.images %}
                                        <div class="image-container" data-image-path="{{ image.image_path }}">
                                            <img src="{{ url_for('static', filename='uploads/' + image.image_path) }}"
                                                alt="Image" class="img-thumbnail" style="max-width: 150px;">
                                            <!-- Form for Deleting Image -->
    
                                            <button type="button" class="btn btn-danger btn-sm ms-2"
                                                onclick="confirmDeleteCaseImage({{ case_study.case_study_id }}, '{{ image.image_path }}')">
                                                Delete
                                            </button>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Update Case Study</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- {% endfor %} -->
    
    
            <!-- View Image Modal -->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title" id="myModalLabel">View Image</h4>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Modal content goes here -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
    
    
    
            <!-- Confirmation Dialog for Deleting Image -->
            <div class="modal fade" id="confirmDeleteCaseImageDialog" tabindex="-1"
                aria-labelledby="confirmDeleteCaseImageDialogLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="confirmDeleteCaseImageDialogLabel">Confirm Deletion</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to delete this image?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <!-- <button type="button" class="btn btn-primary" id="confirmDeleteCaseImageButton">Delete</button> -->
                        </div>
                    </div>
                </div>
            </div>
    
    
        </div>
    </section>
    
    
    <!------------------------------------------------ Blog Section --------------------------------------->
    <section class="blog__section" id="blog">
    
        <div class="container">
            <!-- <h3 class="blog__heading">Add New blog <span class="icon"><i class="bi bi-plus" data-bs-toggle="modal" data-bs-target="#addBlogModal"></i></span></h3> -->
            <div class="blog_texts d-flex p-3">
                <h3 class="blog__heading">Add New blog <span class="icon"><i class="bi bi-plus" data-bs-toggle="modal"
                            data-bs-target="#addBlogModal"></i></span></h3>
                <a href="{{ url_for('blogs.blogs') }}" class="view_all">View All
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>
    
            <!-- Add Modal -->
            <div class="modal fade" id="addBlogModal" tabindex="-1" aria-labelledby="addBlogModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addBlogModalLabel">Add New Blog</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Your Form Here -->
                            <form id="addBlogForm" enctype="multipart/form-data" method="POST" action="{{ url_for('blogs.add_blog')}}">
                                <!-- Image Preview (optional, will be updated with JS) -->
                                <div id="imagePreview" class="mb-3" style="display: none;">
                                    <img id="selectedImage" src="#" alt="Selected Image" class="img-fluid">
                                </div>                                
                                <div class="mb-3">
                                    <label for="blogTitle" class="form-label">Blog Title</label>
                                    <input type="text" class="form-control" id="blogTitle" name="title"
                                        placeholder="Enter blog title">
                                </div>
                                <div class="mb-3">
                                    <label for="blogContent" class="form-label">Blog Content</label>
                                    <textarea class="form-control markdown-editor" id="blogContent" name="content" rows="5"></textarea>
                                    <a href="https://froala.com/blog/editor/10-quick-tips-about-a-great-markdown-editor/" target="_blank"
                                        class="text-decoration-none">Click here to learn how to use this form</a>

                                </div>

                                <!-- Image Picker -->
                                <div class="mb-3">
                                    <label for="imageInput" class="form-label">Upload Images</label>
                                    <input type="file" class="form-control" id="imageInput" name="images[]" accept="image/*" multiple>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" form="addBlogForm" class="btn btn-primary">Save Blog</button>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="section__container">
                <div class="blog__container">
                    {% for blog in blogs[:3] %}
                    <div class="blog__card">
                        <img src="{{ url_for('static', filename='uploads/' ~ blog.first_image_path) if blog.first_image_path else 'static/images/default-image.jpg' }}"
                            alt="{{ blog.title }}">
                        <div class="text-box">
                            <a class="blog_title" href="{{ url_for('blogs.blog_details', blog_id=blog.blog_id) }}">
                                {% if blog.title|length > 200 %}
                                {{ blog.title[:200] }}
                                {% else %}
                                {{ blog.title }}
                                {% endif %}
                            </a>
                            <div class="edit_or_delete">
                                <!-- <span class="icon edit" data-blog-id="{{ blog.blog_id }}" data-bs-toggle="modal"
                                        data-bs-target="#editBlogModal" onclick="openEditBlogModal({{ blog.blog_id }})">
                                        <i class="bi bi-pen"></i>
                                    </span> -->
                                <span class="icon edit" data-bs-toggle="modal"
                                    data-bs-target="#editBlogModal-{{ blog.blog_id }}">
                                    <i class="bi bi-pen"></i>
                                </span>
                                <form method="POST" id="deleteBlogForm-{{ blog.blog_id }}"
                                    action="{{ url_for('blogs.delete_blog', blog_id=blog.blog_id) }}" style="display:inline;">
                                    <button type="button" class="icon delete" onclick="confirmDeleteBlog('{{ blog.blog_id }}')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
    
                </div>
    
    
    
                <!-- Edit Blog Modal -->
                {% for blog in blogs %}
                <div class="modal fade" id="editBlogModal-{{ blog.blog_id }}" tabindex="-1"
                    aria-labelledby="editBlogModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editBlogModalLabel">Edit Blog</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editBlogForm-{{ blog.blog_id }}" method="POST"
                                    action="{{ url_for('blogs.edit_blog', blog_id=blog.blog_id) }}" enctype="multipart/form-data">
                                    <input type="hidden" name="blog_id" value="{{ blog.blog_id }}">
    
                                    <div class="mb-3">
                                        <label for="editBlogTitle-{{ blog.blog_id }}" class="form-label">Title</label>
                                        <input type="text" class="form-control" id="editBlogTitle-{{ blog.blog_id }}"
                                            name="title" value="{{ blog.title }}" required>
                                    </div>
    
                                    <div class="mb-3">
                                        <label for="editBlogContent-{{ blog.blog_id }}" class="form-label markdown-editor">Content</label>
                                        <textarea class="form-control markdown-editor" id="editBlogContent" name="content"
                                            rows="10">{{ blog.content }}</textarea>
                                        <a href="https://froala.com/blog/editor/10-quick-tips-about-a-great-markdown-editor/" target="_blank"
                                            class="text-decoration-none">Click here to learn how to use this form</a>

                                    </div>
    
                                    <div class="mb-3">
                                        <label class="form-label">Current Images</label>
                                        <div id="editBlogImages-{{ blog.blog_id }}" class="edit__blog-existing-images">
                                            {% for image in blog.images %}
                                            <div class="image-container" data-image-id="{{ image.blog_media_id }}">
                                                <img src="{{ url_for('static', filename='uploads/' ~ image.filename) }}"
                                                    alt="Blog Image" class="img-thumbnail" style="max-width: 150px; max-height: 100px;">
                                                <button type="button" class="btn btn-danger btn-sm ms-2 img_del_btn"
                                                    onclick="deleteEditBlogImage({{ image.blog_media_id }}, '{{ image.filename }}')">Delete</button>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
    
                                    <div class="mb-3">
                                        <label for="newBlogImages-{{ blog.blog_id }}" class="form-label">Add New
                                            Images</label>
                                        <input type="file" class="form-control" id="newBlogImages-{{ blog.blog_id }}"
                                            name="images[]" accept="image/*" multiple>
                                    </div>
    
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
    
            </div>
    
        </div>
    
    </section>
    
    
    
    <!------------------------------------------------ Testimonial Section --------------------------------------->
    <section class="testimonials" id="testimonials">
    
        <div class="container">
            <div class="testimonial_texts d-flex p-3">
                <h3 class="testimonial__heading">Add New Testimonial <span class="icon"><i class="bi bi-plus"
                            data-bs-toggle="modal" data-bs-target="#addTestimonialModal"></i></span></h3>
                <!-- <a class="view_all">View All
                        <i class="bi bi-chevron-right" data-bs-toggle="modal" data-bs-target="#addCompanyModal"></i>
                    </a> -->
                <!-- <a class="view_all" href="{{ url_for('testimonials.testimonials') }}">View All
                    <i class="bi bi-chevron-right"></i>
                </a> -->
            </div>
    
    
            <!-- Add New Testimonial Modal -->
            <div class="modal fade" id="addTestimonialModal" tabindex="-1" aria-labelledby="addTestimonialModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addTestimonialModalLabel">Add New Testimonial</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Testimonial Form -->
                            <form action="{{ url_for('testimonials.add_testimonial') }}" method="POST" enctype="multipart/form-data">
    
                                
                                <!-- Testifier Name -->
                                <div class="mb-3">
                                    <label for="testifierName" class="form-label">Name</label>
                                    <input type="text" class="form-control testimonial-input" id="testifierName" name="testifierName"
                                        placeholder="Enter name" required>
                                </div>
    
                                <!-- Testifier Title -->
                                <div class="mb-3">
                                    <label for="testifierTitle" class="form-label">Title</label>
                                    <input type="text" class="form-control" id="testifierTitle" name="testifierTitle"
                                        placeholder="Enter title (e.g., architect)" required>
                                </div>
    
                                <!-- Testimonial Text -->
                                <div class="mb-3">
                                    <label for="testimonialText" class="form-label">Testimonial Text</label>
                                    <textarea type="text" class="form-control testimnialcontent" id="testimonialText" name="testimonialText" row="6"
                                        placeholder="Enter testimony" required rows="6"></textarea>
                                </div>

                                <!-- Image Preview -->
                                <div id="imagePreview" class="mb-3" style="display: none;">
                                    <img id="editSelectedImage" src="#" alt="Selected Image" class="img-fluid">
                                </div>
                                
                                <!-- Image Picker -->
                                <div class="mb-3">
                                    <label for="imageInput" class="form-label">Upload Image (only 1 image allowed)</label>
                                    <input type="file" class="form-control" id="editImageInput" name="image" accept="image/*"
                                        onchange="previewImage(event)" required>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary" id="submitTestimonial" onclick="disableSubmitButton()">Save
                                        Testimonial</button>
                                </div>

                            </form>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="testimonial__section">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        {% for testimonial in testimonials %}
                        <div class="swiper-slide">
                            <div class="testimonialBox">
                                <img src="{{ url_for('static', filename='images/quotes.PNG') }}" alt="" class="quote">
                                <div class="content">
                                    <!-- Link with data attributes for modal content -->
                                    <a href="#" class="testimonial-link text-decoration-none" data-name="{{ testimonial.name }}"
                                        data-title="{{ testimonial.title }}" data-content="{{ testimonial.content }}"
                                        data-image-url="{{ url_for('static', filename='uploads/' ~ testimonial.image.filename) if testimonial.image_id else url_for('static', filename='images/default-image.jpg') }}">
                                        <p>{{ testimonial.content[:180] }}.....</p>
                                    </a>
            
                                    <div class="details">
                                        <div class="imgBx">
                                            {% if testimonial.image_id %}
                                            <img src="{{ url_for('static', filename='uploads/' ~ testimonial.image.filename) }}"
                                                alt="{{ testimonial.name }}">
                                            {% else %}
                                            <img src="{{ url_for('static', filename='images/default-image.jpg') }}"
                                                alt="Default Image">
                                            {% endif %}
                                        </div>
                                        <h3>{{ testimonial.name }}<br><span>{{ testimonial.title }}</span></h3>
                                    </div>
                                </div>
                                <!-- Edit and Delete Options -->
                                <div class="edit_or_delete">
                                    <span class="icon edit">
                                        <a href="#" class="edit-testimonial-btn" data-bs-toggle="modal" data-bs-target="#editTestimonialModal"
                                            data-id="{{ testimonial.testimonial_id }}" data-name="{{ testimonial.name }}"
                                            data-title="{{ testimonial.title }}" data-content="{{ testimonial.content }}"
                                            data-image-url="{% if testimonial.image_id %}{{ url_for('static', filename='uploads/' ~ testimonial.image.filename) }}{% else %}{{ url_for('static', filename='images/default-image.jpg') }}{% endif %}">
                                            <i class="bi bi-pen text-light"></i>
                                        </a>
                                    </span>  

                                    <form method="POST"
                                        action="{{ url_for('testimonials.delete_testimonial', testimonial_id=testimonial.testimonial_id) }}"
                                        style="display:inline;">
                                        <button type="button" class="icon delete"
                                            onclick="confirmDeleteTestimonial(this.form, '{{ testimonial.testimonial_id }}')">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <!-- Swiper pagination -->
                    <div class="swiper-pagination pt-5 mt-4"></div>
                </div>
            </div>
            
            <!-- Single Modal for displaying testimonial details -->
            <div class="modal fade" id="testimonialModal" tabindex="-1" aria-labelledby="testimonialModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="testimonialModalLabel"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="imgBx">
                                <img id="testimonialImage" src="" alt="Testimonial Image" class="img-fluid">
                            </div>
                            <p id="testimonialContent"></p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
           
        <!-- Single Edit Testimonial Modal -->
        <div class="modal fade" id="editTestimonialModal" tabindex="-1" aria-labelledby="editTestimonialModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editTestimonialModalLabel">Edit Testimonial</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <input type="hidden" id="testimonialId" name="testimonial_id">
                            <div class="mb-3">
                                <label for="testimonialName" class="form-label">Name</label>
                                <input type="text" class="form-control" id="testimonialName" name="name">
                            </div>
                            <div class="mb-3">
                                <label for="testimonialTitle" class="form-label">Title</label>
                                <input type="text" class="form-control" id="testimonialTitle" name="title">
                            </div>
                            <div class="mb-3">
                                <label for="testimonialContent" class="form-label">Content</label>
                                <textarea class="form-control" id="testimonialContent" name="content" rows="9"></textarea>
                            </div>
                            <div class="mb-3 text-center d-flex">
                                <img id="testimonialImage" src="" alt="Testimonial Image" class="img-fluid rounded" style="height: 150px; width: 150px;">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>

    </section>
    

    <section class="manageusers" id="users">
        <div class="container mt-5">
            <h1 class="text-center">Manage Users</h1>
    
            <!-- Table for Normal Users -->
            <h3 class="mt-4">Normal Users</h3>
            <table class="table table-striped mt-4 mb-4">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Admin</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ 'Yes' if user.is_admin else 'No' }}</td>
                        <td>
                            <button class="btn btn-success btn-sm" onclick="openSendEmailModal('{{ user.email }}', '{{ user.username }}')">
                                Send Email
                            </button>
                            {% if user.is_admin %}
                            <!-- Remove Admin -->
                            <button class="btn btn-warning btn-sm"
                                onclick="showAuthorizationModal('{{ user.username }}', '{{ url_for('admin.remove_admin', user_id=user.id) }}')">
                                Remove Admin
                            </button>
                            {% else %}
                            <!-- Make Admin -->
                            <button class="btn btn-primary btn-sm"
                                onclick="showAuthorizationModal('{{ user.username }}', '{{ url_for('admin.make_admin', user_id=user.id) }}')">
                                Make Admin
                            </button>

                            {% endif %}
                            <button class="btn btn-danger btn-sm"
                                onclick="showAuthorizationModal('{{ user.username }}', '{{ url_for('admin.delete_user', user_id=user.id) }}')">
                                Delete User
                            </button>
                            
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>


    
            <!-- Table for Newsletter Subscribers -->
            <h3 class="text-center mt-4" id="newsletters">Newsletter Subscribers</h3>
            <table class="table table-striped mt-4 mb-4" >
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Email</th>
                        <th>Actions</th>
                        <th>
                            <button class="btn btn-primary btn-sm" onclick="sendNewsletterModal()">
                                Send Newsletters
                            </button>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for subscriber in subscribers %}
                    <tr>
                        <td>{{ subscriber.id }}</td>
                        <td>
                            {{ subscriber.email }}
                            {% if not subscriber.is_subscribed %}
                            <span style="color: red; font-size: 12px; font-weight: bold;">(Unsubscribed)</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

    
            <!-- Table for Normal Admins -->
            <h3 class="text-center mt-4">Normal Admins</h3>
            <table class="table table-striped mt-3 mb-4">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Position</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users if user.role == 'normal_admin' %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.position }}</td>
                        <td>{{ user.role }}</td>
                        <td>
                            <button class="btn btn-success btn-sm" onclick="openSendEmailModal('{{ user.email }}', '{{ user.username }}')">
                                Send Email
                            </button>

                            <!-- Promote to Main Admin -->
                            <button class="btn btn-success btn-sm"
                                onclick="showAuthorizationModal('{{ user.username }}', '{{ url_for('admin.promote_to_main_admin', user_id=user.id) }}')">
                                Promote to Main Admin
                            </button>

                            <!-- Remove Admin -->
                            <button class="btn btn-warning btn-sm"
                                onclick="showAuthorizationModal('{{ user.username }}', '{{ url_for('admin.remove_admin', user_id=user.id) }}')">
                                Remove Admin
                            </button>
                            <!-- <button class="btn btn-danger btn-sm"
                                onclick="confirmDelete('{{ url_for('admin.delete_user', user_id=user.id) }}')">
                                Delete User
                            </button> -->
                            <button class="btn btn-danger btn-sm"
                                onclick="showAuthorizationModal('{{ user.username }}', '{{ url_for('admin.delete_user', user_id=user.id) }}')">
                                Delete User
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
    
            <!-- Table for Main Admins -->
            {% if current_user.role == 'main_admin' %}
            <h3 class="text-center mt-4">Main Admins</h3>
            <table class="table table-striped mt-3 mb-4">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Position</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users if user.role == 'main_admin' %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.position }}</td>
                        <td>{{ user.role }}</td>
                        <td>
                            <!-- <button class="btn btn-warning btn-sm"
                                onclick="confirmDemote('{{ url_for('admin.demote_to_normal', user_id=user.id) }}')">
                                Demote to Normal Admin
                            </button> -->

                            <button class="btn btn-success btn-sm" onclick="openSendEmailModal('{{ user.email }}', '{{ user.username }}')">
                                Send Email
                            </button>
                            <!-- Demote to Normal -->
                            <button class="btn btn-warning btn-sm"
                                onclick="showAuthorizationModal('{{ user.username }}', '{{ url_for('admin.demote_to_normal', user_id=user.id) }}')">
                                Demote to Normal Admin
                            </button>

                            <button class="btn btn-danger btn-sm"
                                onclick="showAuthorizationModal('{{ user.username }}', '{{ url_for('admin.delete_user', user_id=user.id) }}')">
                                Delete User
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>


        <div class="container mt-5">
            <h2 class="text-center">Action History</h2>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Performed By</th>
                        <th>Action</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in history %}
                    <tr>
                        <td>{{ entry.id }}</td>
                        <td>{{ entry.performed_by }}</td>
                        <td>{{ entry.action }}</td>
                        <td>{{ entry.timestamp }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="container p-4">
            <h2 class="text-center p-4">Download all emails into a spreadsheet</h2>
            {% if users | selectattr('role', 'equalto', 'main_admin') | list %}
            <div class="row mb-3">
                <div class="col-md-6 d-flex align-items-center justify-content-between">
                    <div>
                        <strong>
                            <h3>Main Admin</h3>
                        </strong>
                    </div>
                    <a href="{{ url_for('accounts.download_emails') }}" class="btn btn-success">
                        Download Emails as CSV
                    </a>
                </div>
            </div>
            {% endif %}
        </div>



        <div class="container mt-4 pt-4">
            <h2 class="text-center pb-3">Manage Admin Codes</h2>
            {% for code in codes %}
                {% if current_user.role == 'main_admin' %}
                    <div class="row mb-3">
                        <!-- Main Admin Code Section -->
                        <div class="col-md-6 d-flex align-items-center justify-content-between">
                            <div>
                                <strong><h3>Main Admin Code </h3></strong>
                                <!-- <span id="mainAdminCode">{{ code.main_admin_code }}</span> -->
                            </div>
                            
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#updateCodeModal">
                                Update Code
                            </button>
                            
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
            

            {% for code in codes %}
                <div class="row mb-3">
                    <!-- Normal Admin Code Section -->
                    <div class="col-md-6 d-flex align-items-center justify-content-between">
                        <div>
                            <strong><h3>Normal Admin Code </h3></strong>
                            <!-- <span id="normalAdminCode">{{ code.normal_admin_code }}</span> -->
                        </div>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#updateCodeModal">
                            Update Code
                        </button>
                    </div>
                </div>
            {% endfor %}
        </div>


        <!-- Send Newsletter Modal -->
        <div class="modal fade" id="sendNewsletterModal" tabindex="-1" aria-labelledby="sendNewsletterModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="sendNewsletterModalLabel">Send Newsletters</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form method="POST" action="{{ url_for('accounts.send_newsletters') }}" >
                            <label for="subject">Subject: of the Newsletter</label>
                            <input type="text" name="subject" id="subject" class="form-control" required />
        
                            <label for="email_content">Email Content:</label>
                            <textarea id="email_content" name="email_content" class="form-control" ></textarea>
        
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Send Newsletters</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        
        <script>
            function sendNewsletterModal() {
                const modal = new bootstrap.Modal(document.getElementById('sendNewsletterModal'));
                modal.show();
            }
        </script>


        
        <!-- Authorization Modal for changing the admin codes -->        
        <div class="modal fade" id="updateCodeModal" tabindex="-1" aria-labelledby="updateCodeModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h5 class="modal-title" id="updateCodeModalLabel">Update Admin Code</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
        
                    <!-- Modal Body with Form -->
                    <div class="modal-body">
                        <form method="POST" action="{{ url_for('admin.update_code') }}">
                            <div class="form-group mb-3">
                                <label for="username">Username:</label>
                                <input type="text" class="form-control" name="username" placeholder="Enter your username"
                                    required>
                            </div>
                            <div class="form-group mb-3">
                                <label for="code_type">Code Type:</label>
                                <select name="code_type" class="form-control" required>
                                    <option value="normal">Normal Admin Code</option>
                                    {% if current_user.role == 'main_admin' %}
                                    <option value="main">Main Admin Code</option>
                                    {% endif %}
                                </select>
                            </div>
                            <div class="form-group mb-3">
                                <label for="previous_code">Previous Code:</label>
                                <input type="text" class="form-control" name="previous_code" placeholder="Enter previous code"
                                    required>
                            </div>
                            <div class="form-group mb-3">
                                <label for="new_code">New Code:</label>
                                <input type="text" class="form-control" name="new_code" placeholder="Enter new code" required>
                            </div>
                            <div class="form-group mb-3">
                                <label for="password">Password:</label>
                                <input type="password" class="form-control" name="password" placeholder="Enter your password"
                                    required>
                            </div>
                            <!-- Submit Button -->
                            <button type="submit" class="btn btn-success">Update Code</button>
                        </form>
                    </div>
        
                    <!-- Modal Footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>



        <!-- Action Confirmation Modal -->
        <div class="modal fade" id="authorizationModal" tabindex="-1" role="dialog" aria-labelledby="authorizationModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h5 class="modal-title" id="updateCodeModalLabel">Authorization Required</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="authorizationForm" method="POST" action="">
                            <div class="form-group">
                                <label for="auth-username" class="col-form-label">Username:</label>
                                <input type="text" class="form-control" id="auth-username" name="username" placeholder="Enter your username"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="auth-password" class="col-form-label">Password:</label>
                                <input type="password" class="form-control" id="auth-password" name="password" placeholder="Enter your password"
                                    required>
                            </div>
                            <!-- Hidden field removed since action is set dynamically -->
                        </form>

                    </div>
                    <!-- Modal Footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" form="authorizationForm" class="btn btn-primary">Authorize</button>
                    </div>
                </div>
            </div>
        </div>
        <h2 class="text-center mt-5">Send Emails</h2>
        <div class="container d-flex mt-3" style="column-gap: 10px; text-align: center; justify-content: center;">
            <a class="btn btn-primary" href="{{ url_for('accounts.send_new_email', group='admins') }}">
                Send Mail to all Admins
            </a>
            <a class="btn btn-warning" href="{{ url_for('accounts.send_new_email', group='normal_users') }}">
                Send Mail to Normal Users
            </a>
            <a class="btn btn-primary" href="{{ url_for('accounts.send_new_email', group='all') }}">
                Send Mail to all Accounts
            </a>
        </div>


        
        <div class="modal fade" id="sendEmailModal" tabindex="-1" aria-labelledby="sendEmailModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="sendEmailModalLabel">Send Email</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form method="POST" action="{{ url_for('accounts.send_individual_email') }}">
                            <input type="hidden" name="recipient_email" id="recipient_email" />
                            <label for="subject">Subject:</label>
                            <input type="text" name="subject" id="subject" class="form-control" required />
        
                            <label for="email_content">Email Content:</label>
                            <textarea id="email_content" name="email_content" class="form-control"></textarea>
        
                            <!-- <button type="submit" class="btn btn-primary mt-3">Send Email</button> -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Send Email</button>
                            </div>
                        </form>
                    </div>
                    <div class="container" role="status">
                        <div id="loadingSpinner" class="d-none text-center mt-3">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p>Sending emails, please wait...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
        <script>
            const form = document.querySelector('form');
            const loadingSpinner = document.getElementById('loadingSpinner');

            form.addEventListener('submit', function (event) {
                // Show the spinner
                loadingSpinner.classList.remove('d-none');

                // Optionally disable the submit button to prevent multiple submissions
                const submitButton = form.querySelector('button[type="submit"]');
                submitButton.disabled = true;
            });
        </script>
        <!-- SimpleMDE JavaScript -->
        <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
        <script>
            // Initialize SimpleMDE editor
            var simplemde = new SimpleMDE({
                element: document.getElementById("email_content"),
                autosave: true,
                placeholder: "Compose your email using Markdown...",
                spellChecker: true,
                toolbar: ["bold", "italic", "heading", "|", "quote", "unordered-list", "ordered-list", "|", "link", "image", "|", "preview", "side-by-side", "fullscreen"]
            });

            function previewEmail() {
                const content = simplemde.value(); // Get Markdown content
                const previewDiv = document.getElementById('emailPreviewContent');

                // Use a Markdown parser in JavaScript to preview (e.g., marked.js)
                previewDiv.innerHTML = marked(content); // You need to include marked.js for this
                document.getElementById('previewModal').style.display = 'block';
            }
        </script>
        <script>
            function openSendEmailModal(email, username) {
                console.log('Opening modal for:', email, username);

                const emailField = document.querySelector('#recipient_email');
                emailField.value = email;

                const usernameField = document.querySelector('#username_placeholder');
                if (usernameField) {
                    usernameField.textContent = username;
                }

                const modal = new bootstrap.Modal(document.querySelector('#sendEmailModal'));
                modal.show();
            }

        </script>


        <script>
            function confirmAction(url, message) {
                document.getElementById('actionMessage').innerText = message;
                document.getElementById('actionForm').action = url;
                new bootstrap.Modal(document.getElementById('actionModal')).show();
            }
        </script>

        <script>
            function showAuthorizationModal(username, actionUrl) {
                // Clear previous values
                document.getElementById('auth-username').value = '';
                document.getElementById('auth-password').value = '';

                // Set the form's action URL dynamically
                const form = document.getElementById('authorizationForm');
                form.action = actionUrl;  // Set the form action to the correct route

                // Show the modal
                $('#authorizationModal').modal('show');
            }
        </script>


    </section>

    

{% endblock %}

{% block scripts %}

    <script>
        function confirmPromote(url) {
            const username = prompt("Enter your username:");
            const password = prompt("Enter your password:");
            if (username && password) {
                fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                }).then(response => location.reload());
            }
        }

        function confirmDemote(url) {
            const username = prompt("Enter your username:");
            const password = prompt("Enter your password:");
            if (username && password) {
                fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                }).then(response => location.reload());
            }
        }

        function confirmDelete(url) {
            const username = prompt("Enter your username:");
            const password = prompt("Enter your password:");
            if (username && password) {
                fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                }).then(response => location.reload());
            }
        }
    </script>
    
    <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>

    <script>
        document.querySelectorAll('.markdown-content a').forEach(function (anchor) {
            anchor.setAttribute('target', '_blank');
        });

    </script>
{% endblock %}